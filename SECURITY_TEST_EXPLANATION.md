# üîç –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç:

```typescript
// –ü–õ–û–•–û - –ø–æ–º–æ–≥–∞–µ—Ç –∞—Ç–∞–∫–µ
await supabase2
  .from('tasks')
  .delete()
  .eq('id', testTask1.id)
  .eq('user_id', userId1);  // ‚Üê –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–±–æ–π—Ç–∏ RLS!
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞?

1. **User 2 –∑–Ω–∞–µ—Ç ID –∑–∞–¥–∞—á–∏ User 1** (—ç—Ç–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏)
2. **–ù–æ User 2 –ù–ï –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å `user_id` User 1** –¥–ª—è –∞—Ç–∞–∫–∏
3. –ü–µ—Ä–µ–¥–∞–≤–∞—è `.eq('user_id', userId1)` –≤ –∑–∞–ø—Ä–æ—Å–µ, –º—ã:
   - –ü–æ–º–æ–≥–∞–µ–º –∞—Ç–∞–∫—É—é—â–µ–º—É
   - –î–µ–ª–∞–µ–º —Ç–µ—Å—Ç –º–µ–Ω–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º
   - –ú–æ–∂–µ–º –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å RLS

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ—Å—Ç:

```typescript
// –•–û–†–û–®–û - —Ç–æ–ª—å–∫–æ ID –∑–∞–¥–∞—á–∏ (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∞—Ç–∞–∫–µ)
await supabase2
  .from('tasks')
  .delete()
  .eq('id', testTask1.id);  // –¢–æ–ª—å–∫–æ ID, –±–µ–∑ user_id!
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ?

1. **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
   - –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –∑–Ω–∞–µ—Ç ID –∑–∞–¥–∞—á–∏ (–º–æ–∂–µ—Ç —É–≥–∞–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º)
   - –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ù–ï –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å user_id –≤–ª–∞–¥–µ–ª—å—Ü–∞
   - –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø—ã—Ç–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ ID

2. **RLS –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
   - `auth.uid()` (—Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = User 2)
   - `user_id` –≤ —Å—Ç—Ä–æ–∫–µ (–≤–ª–∞–¥–µ–ª–µ—Ü = User 1)
   - `auth.uid() != user_id` ‚Üí RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç

3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ RLS:**
   - RLS –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–∫ —Å—Ç—Ä–æ–∫–∞–º**, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã WHERE
   - –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è: `auth.uid() = user_id`
   - –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí —Å—Ç—Ä–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–¢–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è—é—Ç **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏**:

1. User 2 –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ ID –∑–∞–¥–∞—á–∏ User 1
2. User 2 –ø—ã—Ç–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ ID
3. RLS –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∞—Ç–∞–∫–∏** (—Ç–æ–ª—å–∫–æ ID, –±–µ–∑ user_id)
- **–ü—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É RLS** (–ø—Ä–æ–≤–µ—Ä–∫–∞ auth.uid() vs user_id –≤ —Å—Ç—Ä–æ–∫–µ)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

---

## üéØ –í—ã–≤–æ–¥

–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã! –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞—Ç–∞–∫—É, –≥–¥–µ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫:
- ‚úÖ –ó–Ω–∞–µ—Ç ID –∑–∞–¥–∞—á–∏
- ‚ùå –ù–ï –∑–Ω–∞–µ—Ç user_id –≤–ª–∞–¥–µ–ª—å—Ü–∞
- ‚ùå –ù–ï –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å user_id –≤ –∑–∞–ø—Ä–æ—Å–µ

RLS –¥–æ–ª–∂–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–æ–≤–µ—Ä—è—è `auth.uid() = user_id` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏.

**–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã!** üéâ


