# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –û–ë–ù–ê–†–£–ñ–ï–ù–ê!

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

**–¢–µ—Å—Ç—ã 4 –∏ 5 –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å:**
- ‚ùå User 2 –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É User 1
- ‚ùå User 2 –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É User 1

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ RLS (Row Level Security) –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Supabase!**

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Test 3)** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏
2. ‚úÖ **RLS –¥–ª—è SELECT** - –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. ‚úÖ **–ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `user_id` –≤–æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

---

## ‚ö†Ô∏è –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç

1. ‚ùå **RLS –¥–ª—è DELETE** - –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ —á—É–∂–∏—Ö –∑–∞–¥–∞—á
2. ‚ùå **RLS –¥–ª—è UPDATE** - –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á—É–∂–∏—Ö –∑–∞–¥–∞—á

---

## üîß –†–ï–®–ï–ù–ò–ï: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://app.supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **Tables** ‚Üí **tasks**

### –®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç–µ RLS

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `tasks`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Policies**
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **Row Level Security** –≤–∫–ª—é—á–µ–Ω (Enable RLS)

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ/–û–±–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏

–û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ Supabase Dashboard –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
DROP POLICY IF EXISTS "Users can delete only their own tasks" ON tasks;
DROP POLICY IF EXISTS "Users can update only their own tasks" ON tasks;

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è DELETE
CREATE POLICY "Users can delete only their own tasks"
ON tasks
FOR DELETE
USING (auth.uid()::text = user_id);

-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è UPDATE
CREATE POLICY "Users can update only their own tasks"
ON tasks
FOR UPDATE
USING (auth.uid()::text = user_id)
WITH CHECK (auth.uid()::text = user_id);
```

**–í–∞–∂–Ω–æ:**
- `auth.uid()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç UUID —Ç–∏–ø–∞ `uuid`
- `user_id` –≤ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∏–ø–∞ `text`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `::text` –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø –ø–æ–ª—è `user_id`

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'tasks' AND column_name = 'user_id';
```

–ï—Å–ª–∏ `user_id` –∏–º–µ–µ—Ç —Ç–∏–ø `uuid`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```sql
-- –î–ª—è UUID —Ç–∏–ø–∞
CREATE POLICY "Users can delete only their own tasks"
ON tasks
FOR DELETE
USING (auth.uid() = user_id);

CREATE POLICY "Users can update only their own tasks"
ON tasks
FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª–∏—Ç–∏–∫

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual,
  with_check
FROM pg_policies
WHERE tablename = 'tasks'
ORDER BY cmd, policyname;
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å 4 –ø–æ–ª–∏—Ç–∏–∫–∏:
1. SELECT - `Users can view only their own tasks`
2. INSERT - `Users can insert only their own tasks`
3. UPDATE - `Users can update only their own tasks` ‚Üê **–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å!**
4. DELETE - `Users can delete only their own tasks` ‚Üê **–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å!**

---

## üß™ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RLS, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã —Å–Ω–æ–≤–∞:

```powershell
.\RUN_SECURITY_TEST.bat
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **–í—Å–µ 9 —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ ‚úÖ**

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

1. **RLS —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ª–∏–Ω–∏—è –∑–∞—â–∏—Ç—ã
2. **–ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–∂–µ –∑–∞—â–∏—â–µ–Ω** - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç `user_id`
3. **–ù–æ RLS –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω** - –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø—Ä—è–º—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ

---

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ö–æ–≥–¥–∞ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥—É—Ç:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞—â–∏—â–µ–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ RLS

**–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–Ω—ã–º!**

