-- ============================================
-- РУЧНОЙ ТЕСТ RLS ПОЛИТИК
-- ============================================
-- Выполните этот SQL, будучи залогиненным как User 2 в Supabase
-- ============================================

-- Шаг 1: Проверить текущего пользователя
SELECT 
  auth.uid() as current_user_id,
  auth.email() as current_user_email;

-- Шаг 2: Попробовать удалить задачу другого пользователя
-- Замените 'TASK_ID_USER_1' на ID задачи пользователя 1
DELETE FROM tasks 
WHERE id = 'TASK_ID_USER_1'::uuid;

-- Если RLS работает правильно, это должно либо:
-- - Вернуть ошибку
-- - Или удалить 0 строк (без ошибки)

-- Шаг 3: Попробовать обновить задачу другого пользователя
UPDATE tasks 
SET title = 'HACKED'
WHERE id = 'TASK_ID_USER_1'::uuid;

-- Если RLS работает правильно, это должно либо:
-- - Вернуть ошибку
-- - Или обновить 0 строк (без ошибки)

-- Шаг 4: Проверить, сколько строк было затронуто
-- После DELETE и UPDATE проверьте:
SELECT 
  (SELECT COUNT(*) FROM tasks WHERE id = 'TASK_ID_USER_1'::uuid) as task_still_exists;

-- Если task_still_exists > 0 после DELETE - RLS работает (блокировал удаление)
-- Если task_still_exists = 0 после DELETE - RLS НЕ работает (удаление прошло)

