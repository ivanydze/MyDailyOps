# Supabase Migration Instructions - Visibility Fields

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ **–ü–ï–†–ï–î** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

**–ë–µ–∑ —ç—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚ùå Mobile –±—É–¥–µ—Ç –ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚ùå Desktop –ø–æ–ª—É—á–∏—Ç `undefined` –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –∏–∑ Supabase
- ‚ùå Recurring instances –Ω–µ –±—É–¥—É—Ç –∏–º–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–æ–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìã –®–∞–≥–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Supabase Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://app.supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `supabase/migrations/add_visibility_fields.sql`
5. –í—Å—Ç–∞–≤—å—Ç–µ SQL –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
6. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl+Enter)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Supabase CLI

```bash
# –ï—Å–ª–∏ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Supabase CLI
supabase db push

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ psql –Ω–∞–ø—Ä—è–º—É—é
psql -h <your-db-host> -U postgres -d postgres -f supabase/migrations/add_visibility_fields.sql
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'tasks' 
  AND column_name IN ('duration_days', 'visible_from', 'visible_until')
ORDER BY column_name;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `duration_days` - INTEGER, nullable
- `visible_from` - TEXT, nullable
- `visible_until` - TEXT, nullable

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
SELECT indexname, indexdef
FROM pg_indexes
WHERE tablename = 'tasks' 
  AND indexname LIKE '%visible%';
```

---

## üìù –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è

1. **–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `duration_days`** (INTEGER, nullable)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–∏–º–∞ –¥–æ deadline

2. **–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `visible_from`** (TEXT, nullable)
   - –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞, –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º–æ–π
   - –§–æ—Ä–º–∞—Ç: ISO date string (YYYY-MM-DD)
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: `deadline - (duration_days - 1)`

3. **–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `visible_until`** (TEXT, nullable)
   - –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞, –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –≤–∏–¥–∏–º–∞
   - –í—Å–µ–≥–¥–∞ —Ä–∞–≤–Ω–∞ `deadline`
   - –§–æ—Ä–º–∞—Ç: ISO date string (YYYY-MM-DD)

4. **–°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤–∏–¥–∏–º–æ—Å—Ç–∏

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –í—Å–µ –ø–æ–ª—è **nullable** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ï—Å–ª–∏ –ø–æ–ª—è `NULL`, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É (–≤–∏–¥–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ deadline)
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á –ø–æ–ª—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã

---

## ‚ö° –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å:

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å Mobile —Å—Ö–µ–º—É –ë–î
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å Desktop (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å recurring logic –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ instances
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∑–∞–¥–∞—á

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã?

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `tasks` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

