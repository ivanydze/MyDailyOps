<AddTaskScreen>:
    name: "add_task"
    md_bg_color: app.theme_cls.backgroundColor

    MDBoxLayout:
        orientation: "vertical"
        padding: "0dp", "0dp", "0dp", "20dp"
        spacing: "16dp"

        MDTopAppBar:
            title: "Add New Task"
            md_bg_color: app.theme_cls.surfaceContainerColor
            elevation: 0
            type_height: "small"
            left_action_items: [["arrow-left", lambda x: app.go_to_tasks(), "Back"]]

        ScrollView:
            do_scroll_x: False
            
            MDBoxLayout:
                orientation: "vertical"
                padding: "20dp"
                spacing: "16dp"
                size_hint_y: None
                height: self.minimum_height

                # Title Field
                MDTextField:
                    id: title
                    mode: "outlined"
                    size_hint_x: 1
                    multiline: False
                    write_tab: False
                    text_color_normal: 0, 0, 0, 0.87
                    text_color_focus: 0.12, 0.46, 0.8, 1
                    line_color_normal: 0, 0, 0, 0.38
                    line_color_focus: 0.12, 0.46, 0.8, 1
                    
                    MDTextFieldHintText:
                        text: "Task Title *"
                    
                    MDTextFieldHelperText:
                        text: "Required - What needs to be done?"
                        mode: "persistent"

                # Description Field
                MDTextField:
                    id: description
                    mode: "outlined"
                    size_hint_x: 1
                    multiline: True
                    write_tab: False
                    text_color_normal: 0, 0, 0, 0.87
                    text_color_focus: 0.12, 0.46, 0.8, 1
                    line_color_normal: 0, 0, 0, 0.38
                    line_color_focus: 0.12, 0.46, 0.8, 1
                    
                    MDTextFieldHintText:
                        text: "Description"
                    
                    MDTextFieldHelperText:
                        text: "Optional - Additional details"
                        mode: "on_focus"

                # Category Field (Dropdown)
                MDBoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "56dp"
                    spacing: "8dp"
                    
                    MDTextField:
                        id: category
                        mode: "outlined"
                        multiline: False
                        readonly: True
                        text_color_normal: 0, 0, 0, 0.87
                        text_color_focus: 0.12, 0.46, 0.8, 1
                        line_color_normal: 0, 0, 0, 0.38
                        line_color_focus: 0.12, 0.46, 0.8, 1
                        on_focus: if self.focus and self.readonly: root.open_category_menu(self)
                        
                        MDTextFieldHintText:
                            text: "Category (tap to select)"
                        
                        MDTextFieldHelperText:
                            text: "Select: Work, Personal, Health, Finance, Other"
                            mode: "persistent"
                    
                    MDIconButton:
                        icon: "menu-down"
                        theme_icon_color: "Custom"
                        icon_color: app.theme_cls.primaryColor
                        on_release: root.open_category_menu(category)
                        pos_hint: {"center_y": 0.5}

                # Deadline Field with Date Picker
                MDBoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "56dp"
                    spacing: "8dp"
                    
                    MDTextField:
                        id: deadline
                        mode: "outlined"
                        multiline: False
                        readonly: True
                        text_color_normal: 0, 0, 0, 0.87
                        text_color_focus: 0.12, 0.46, 0.8, 1
                        line_color_normal: 0, 0, 0, 0.38
                        line_color_focus: 0.12, 0.46, 0.8, 1
                        on_focus: if self.focus: root.open_date_picker()
                        
                        MDTextFieldHintText:
                            text: "Deadline (tap to select)"
                        
                        MDTextFieldHelperText:
                            text: "Optional - Click to select date and time"
                            mode: "persistent"
                    
                    MDIconButton:
                        icon: "calendar"
                        theme_icon_color: "Custom"
                        icon_color: app.theme_cls.primaryColor
                        on_release: root.open_date_picker()
                        pos_hint: {"center_y": 0.5}

                # Priority Field (Dropdown)
                MDBoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "56dp"
                    spacing: "8dp"
                    
                    MDTextField:
                        id: priority
                        mode: "outlined"
                        multiline: False
                        readonly: True
                        text_color_normal: 0, 0, 0, 0.87
                        text_color_focus: 0.12, 0.46, 0.8, 1
                        line_color_normal: 0, 0, 0, 0.38
                        line_color_focus: 0.12, 0.46, 0.8, 1
                        on_focus: if self.focus: root.open_priority_menu(self)
                        
                        MDTextFieldHintText:
                            text: "Priority (tap to select)"
                        
                        MDTextFieldHelperText:
                            text: "Select: Low, Medium, or High"
                            mode: "persistent"
                    
                    MDIconButton:
                        icon: "menu-down"
                        theme_icon_color: "Custom"
                        icon_color: app.theme_cls.primaryColor
                        on_release: root.open_priority_menu(priority)
                        pos_hint: {"center_y": 0.5}

                # Error Label
                MDLabel:
                    id: error
                    text: ""
                    halign: "center"
                    font_style: "Body"
                    role: "small"
                    theme_text_color: "Custom"
                    text_color: app.theme_cls.errorColor
                    size_hint_y: None
                    height: self.texture_size[1] if self.text else 0

                # Spacer
                Widget:
                    size_hint_y: None
                    height: "20dp"

                # Save Button
                MDButton:
                    style: "filled"
                    size_hint: (0.7, None)
                    height: "56dp"
                    pos_hint: {"center_x": .5}
                    md_bg_color: app.theme_cls.primaryColor
                    on_release: root.save_task()
                    
                    MDButtonText:
                        text: "Save Task"
                        theme_text_color: "Custom"
                        text_color: app.theme_cls.onPrimaryColor
