<TasksScreen>:
    md_bg_color: app.theme_cls.backgroundColor
    
    MDBoxLayout:
        orientation: "vertical"

        # Top App Bar
        MDTopAppBar:
            title: "My Tasks"
            md_bg_color: app.theme_cls.surfaceContainerColor
            elevation: 0
            type_height: "small"
            left_action_items: [["magnify", lambda x: root.toggle_search(), "Search tasks"]]
            right_action_items: [["filter-variant", lambda x: root.open_filter_menu(x), "Filter"], ["refresh", lambda x: root.load_tasks(), "Refresh"]]

        # Search field (expandable)
        MDBoxLayout:
            id: search_field
            size_hint_y: None
            height: "0dp"
            opacity: 0
            padding: "16dp", "8dp", "16dp", "8dp"
            md_bg_color: app.theme_cls.surfaceContainerColor

            MDTextField:
                mode: "outlined"
                hint_text: "Search tasks..."
                on_text: root.on_search(self.text)
                radius: [8]

        # Filter banner (shows when filter is active)
        MDBoxLayout:
            id: filter_banner
            size_hint_y: None
            height: "36dp" if root.current_filter != "all" else "0dp"
            opacity: 1 if root.current_filter != "all" else 0
            padding: "16dp", "8dp"
            md_bg_color: app.theme_cls.secondaryContainerColor
            
            MDLabel:
                text: f"Filtered: {root.current_filter.capitalize()}"
                font_style: "Body"
                role: "small"
                theme_text_color: "Custom"
                text_color: app.theme_cls.onSecondaryContainerColor
                size_hint_x: 0.9
            
            MDIconButton:
                icon: "close"
                icon_size: "20sp"
                size_hint_x: None
                width: "32dp"
                on_release: root.set_filter("all")

        # Task list scroll area
        ScrollView:
            do_scroll_x: False
            
            MDBoxLayout:
                id: tasks_list
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                padding: "16dp", "16dp", "16dp", "80dp"  # Bottom padding for FAB
                spacing: "8dp"
    
    # Floating Action Button (Add Task)
    MDFabButton:
        icon: "plus"
        style: "large"
        theme_bg_color: "Custom"
        md_bg_color: app.theme_cls.primaryColor
        theme_icon_color: "Custom"
        icon_color: 1, 1, 1, 1
        pos_hint: {"center_x": 0.9, "center_y": 0.1}
        on_release: root.open_add_task()
